'use strict';
var ice_worker = require('ice_worker');
var ice_time = require('ice_time');

//var q = require('ice_q');
var _ = require('underscore');


var start = ice_time();
var g_counter = 100;
_.each(_.range(0,g_counter), function(num){

  /**
   * начинаем дергать workerы hello из других процессов (либо из своего если воркер зареген в своем процессе)
   */
  ice_worker.call_worker('hello', num, num+1, num+2)
  .then(function(worker_result){
    
    if(worker_result[0]!==num){
      console.error('bad result');
    }
    
    console.log('RECEIVE RESPONSE', worker_result, g_counter);
    
    g_counter--;
    if(g_counter===0){
      console.log('TIME ',ice_time() - start);
    }

  })
  .catch(function(e){
    console.log(e);
  }).done();


});